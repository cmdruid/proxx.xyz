<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>proxx.xyz</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>proxx.xyz - Short URLs for your code projects.</h1>
        <img class="logo" src="">
    </header>
    <form class="form" v-if="formVisible" @submit.prevent="createUrl()">
        <div class="error"></div>
        <input class="input" type="text" v-model="url" name="url" placeholder="enter a url">
        <input class="input" type="text" v-model="slug" name="slug" placeholder="enter a slug">
        <button type="submit" class="create">create</button>
    </form>
        <div class="created"></div>
    <script>
        const form    = document.querySelector('form'),
              error   = document.querySelector('.error'),
              created = document.querySelector('.created');

        error.style.display = 'none';
        form.addEventListener('submit', async (e) => {

        e.preventDefault();

        const formData = new FormData(form),
              url      = formData.get('url'),
              slug     = formData.get('slug');

        const options  = {
            method: 'POST',
            headers: { 'content-type': 'application/json' },
            body: JSON.stringify({ url: url, slug: slug || undefined })
        };

        const response = await fetch('/url', options);
            if (response.status === 429) displayError('You are sending too many requests. Try again in 30 seconds.');

            const result = await response.json();
            if (response.ok && result.slug) displaySlug(result.slug);
            if (!response.ok) displayError(result.message);
        });

        function displayError(msg) {
            error.style.display = '';
            error.textContent = msg;
        };

        function displaySlug(slug) {
            const content  = document.createElement('p'),
                shorturl = `https://proxx.xyz/${slug}`;

            form.style.display  = 'none';
            error.style.display = 'none';
            content.innerHTML   = `Your short url is: <a :href="${shorturl}">${shorturl}</a>`;
            created.appendChild(content);
        };
    </script>
    <script src="app.js"></script>
</body>
</html>